<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="starter.data.mapper.RiskMapper">

	
  <select id="findAll" resultType="starter.data.model.Risk">
    SELECT
      rh.id AS riskHeaderId,
      rh.named_Insured AS namedInsured,
      rh.version_number AS versionNumber,
      UPPER(status.name) AS status
    FROM
      risk_header rh,
      status status
    WHERE
      rh.active_flag = 'Y' AND
      status.id = rh.status_id 
    ORDER BY rh.id
  </select>
  
  <select id="findAllBySearchFilter" resultType="starter.data.model.Risk">
    SELECT
      rh.named_Insured AS namedInsured,
      UPPER(status.name) AS status
    FROM
      risk_header rh,
      status status
    WHERE
      rh.active_flag = 'Y' AND
      status.id = rh.status_id
      <if test="statusId != null">
        AND rh.status_id = #{statusId}
      </if>
      <if test="startDate != null">
        AND created_date &gt;= #{startDate}
      </if>
      <if test="endDate != null">
        AND created_date &lt;= #{endDate}
      </if>
    ORDER BY rh.id
  </select>
  
  <select id="findAllByPaginationParams" resultType="starter.data.model.Risk">
    SELECT
      rh.named_Insured AS namedInsured,
      UPPER(status.name) AS status
    FROM
      risk_header rh,
      status status
    WHERE
      rh.active_flag = 'Y' AND
      status.id = rh.status_id
      <if test="searchFilter != null &amp;&amp; searchFilter.statusId != null">
        AND rh.status_id = #{searchFilter.statusId}
      </if>
      <if test="searchFilter != null &amp;&amp; searchFilter.startDate != null">
        AND created_date &gt;= #{searchFilter.startDate}
      </if>
      <if test="searchFilter != null &amp;&amp; searchFilter.endDate != null">
        AND created_date &lt;= #{searchFilter.endDate}
      </if>
    ORDER BY rh.id
    <if test="length != null">
      OFFSET #{length}
    </if>
  </select>
  
  <resultMap type="starter.data.model.DataTablesOutput" id="result-output">
    <id property="recordsFiltered" column="recordsFiltered" />
    <collection property="data" ofType="starter.data.model.Risk">
      <result property="namedInsured" column="namedInsured"/>
      <result property="status" column="status"/>
      <result property="createdDate" column="createdDate"/>
    </collection>
  </resultMap>
  
  <select id="findDataTablesOutputByPaginationParams" resultMap="result-output">
    SELECT
      COUNT(*) OVER() AS recordsFiltered,
      rh.named_Insured AS namedInsured,
      UPPER(status.name) AS status
    FROM
      risk_header rh,
      status status
    WHERE
      rh.active_flag = 'Y' AND
      status.id = rh.status_id
      <if test="searchFilter != null &amp;&amp; searchFilter.statusId != null">
        AND rh.status_id = #{searchFilter.statusId}
      </if>
      <if test="searchFilter != null &amp;&amp; searchFilter.startDate != null">
        AND created_date &gt;= #{searchFilter.startDate}
      </if>
      <if test="searchFilter != null &amp;&amp; searchFilter.endDate != null">
        AND created_date &lt;= #{searchFilter.endDate}
      </if>
    ORDER BY rh.id
    <if test="length != null">
      OFFSET #{length}
    </if>
  </select>
  
  <select id="findDataTablesOutput" resultMap="result-output">
    SELECT
      COUNT(*) OVER() AS recordsFiltered,
      rh.named_Insured AS namedInsured,
      UPPER(status.name) AS status,
      rh.created_date AS createdDate
    FROM
      risk_header rh,
      status status
    WHERE
      rh.active_flag = 'Y' AND
      status.id = rh.status_id
      <if test="searchFilter != null &amp;&amp; searchFilter.statusId != null">
        AND rh.status_id = #{searchFilter.statusId}
      </if>
      <if test="searchFilter != null &amp;&amp; searchFilter.startDate != null">
        AND created_date &gt;= #{searchFilter.startDate}
      </if>
      <if test="searchFilter != null &amp;&amp; searchFilter.endDate != null">
        AND created_date &lt;= #{searchFilter.endDate}
      </if>
      <if test="search != null &amp;&amp; search.value != null">
        AND UPPER(rh.named_insured) like UPPER('%'||#{search.value}||'%')
      </if>
    
      ORDER BY <if test="order.size == 0">rh.id</if>
      <foreach item="item" collection="order" separator=" ">
        <if test="item.column == 0">
          namedInsured <if test="item.dir == 'asc'">ASC</if><if test="item.dir == 'desc'">DESC</if>
        </if>
        <if test="item.column == 1">
          status <if test="item.dir == 'asc'">ASC</if><if test="item.dir == 'desc'">DESC</if>
        </if>
        <if test="item.column == 2">
          createdDate <if test="item.dir == 'asc'">ASC</if><if test="item.dir == 'desc'">DESC</if>
        </if>
      </foreach>
   
    <if test="start != null">
      OFFSET #{start}
    </if>
    <if test="length != null">
      LIMIT #{length}
    </if>
  </select>
  
  <select id="findRecordCount" resultType="java.lang.Integer">
    SELECT
      COUNT(*)
    FROM
      risk_header rh,
      status status
    WHERE
      rh.active_flag = 'Y' AND
      status.id = rh.status_id
  </select>
 
</mapper>